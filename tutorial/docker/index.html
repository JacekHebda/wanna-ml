
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.4, mkdocs-material-8.2.6">
    
    
      
        <title>WANNA Docker - WANNA ML</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.9d5733d3.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#wanna-docker" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="WANNA ML" class="md-header__button md-logo" aria-label="WANNA ML" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WANNA ML
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              WANNA Docker
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/avast/wanna-ml/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    avast/wanna-ml
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="WANNA ML" class="md-nav__button md-logo" aria-label="WANNA ML" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    WANNA ML
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/avast/wanna-ml/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    avast/wanna-ml
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Tutorial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorial" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorial
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Get Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../project/" class="md-nav__link">
        WANNA Project
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../profile/" class="md-nav__link">
        WANNA Profile
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          WANNA Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        WANNA Docker
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#types-of-docker-images" class="md-nav__link">
    Types of docker images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencing-docker-images" class="md-nav__link">
    Referencing docker images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-build-vs-gcp-cloud-build" class="md-nav__link">
    Local build vs GCP Cloud Build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-configuration" class="md-nav__link">
    Build configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameters-for-docker-section" class="md-nav__link">
    Parameters for docker section
  </a>
  
    <nav class="md-nav" aria-label="Parameters for docker section">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#provided-image-parameters" class="md-nav__link">
    Provided image parameters:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-build-image-parameters" class="md-nav__link">
    Local build image parameters:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notebook-ready-image" class="md-nav__link">
    Notebook ready image:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#roles-and-permissions" class="md-nav__link">
    Roles and permissions
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tensorboard/" class="md-nav__link">
        WANNA Tensorboard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../notebook/" class="md-nav__link">
        WANNA Notebook
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../managed-notebook/" class="md-nav__link">
        WANNA Managed Notebook
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../job/" class="md-nav__link">
        WANNA Job
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline/" class="md-nav__link">
        WANNA Pipeline
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../cli/commands/" class="md-nav__link">
        Plugins
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#types-of-docker-images" class="md-nav__link">
    Types of docker images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencing-docker-images" class="md-nav__link">
    Referencing docker images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-build-vs-gcp-cloud-build" class="md-nav__link">
    Local build vs GCP Cloud Build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-configuration" class="md-nav__link">
    Build configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameters-for-docker-section" class="md-nav__link">
    Parameters for docker section
  </a>
  
    <nav class="md-nav" aria-label="Parameters for docker section">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#provided-image-parameters" class="md-nav__link">
    Provided image parameters:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#local-build-image-parameters" class="md-nav__link">
    Local build image parameters:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notebook-ready-image" class="md-nav__link">
    Notebook ready image:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#roles-and-permissions" class="md-nav__link">
    Roles and permissions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/avast/wanna-ml/edit/master/docs/tutorial/docker.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>



<h1 id="wanna-docker">WANNA Docker<a class="headerlink" href="#wanna-docker" title="Permanent link">#</a></h1>
<p>Multiple resources created by WANNA rely on Docker containers. We make it easy for you to
build your images either locally or using GCP Cloud Build. However, the GCP Cloud Build will
not be allowed to use in production.</p>
<h3 id="types-of-docker-images">Types of docker images<a class="headerlink" href="#types-of-docker-images" title="Permanent link">#</a></h3>
<p>We currently support three types of docker images:</p>
<ul>
<li><code>provided_image</code> - you supply a link to the docker image in the registry. We don't build anything,
  just redirect this link to GCP.</li>
<li><code>local_build_image</code> - you supply a Dockerfile with a context directory and additional information.
  We build the image for you on your machine or in the cloud.</li>
<li><code>notebook_ready_image</code> - you supply a list of pip requirements to install in your Jupyter Notebook.
This is useful if you want to start a notebook with custom libraries, but you don't want to handle
  Dockerfile information.</li>
</ul>
<h3 id="referencing-docker-images">Referencing docker images<a class="headerlink" href="#referencing-docker-images" title="Permanent link">#</a></h3>
<p>Each docker image must have a <code>name</code>. By this name, you can later reference it in 
resource configuration, usually as <code>docker_image_ref</code>.</p>
<p>Example:</p>
<pre><code>docker:
  images:
    - build_type: local_build_image
      name: custom-notebook-container-julia
      context_dir: .
      dockerfile: Dockerfile.notebook
  repository: wanna-samples
  cloud_build: true

notebooks:
  - name: wanna-notebook-julia
    environment:
      docker_image_ref: custom-notebook-container-julia
</code></pre>
<h3 id="local-build-vs-gcp-cloud-build">Local build vs GCP Cloud Build<a class="headerlink" href="#local-build-vs-gcp-cloud-build" title="Permanent link">#</a></h3>
<p>By default, all docker images are built locally on your machine and then pushed to the registry.
For faster testing lifecycle you can build images directly using GCP Cloud Build. 
The only needed change is to set <code>cloud_build: true</code> in <code>docker</code> section of the WANNA yaml config
or set <code>WANNA_DOCKER_BUILD_IN_CLOUD=true</code> (env variable takes precedence).</p>
<p>Building in the cloud is generally faster as the docker images are automatically already in the registry
and there is no need to push the images over the network. That makes it suitable for fast testing. 
However, building images in the cloud is not allowed for production.</p>
<h3 id="build-configuration">Build configuration<a class="headerlink" href="#build-configuration" title="Permanent link">#</a></h3>
<p>When building locally, we offer you a way to set additional build parameters. These parameters
must be specified in a separate yaml file in path <code>WANNA_DOCKER_BUILD_CONFIG</code>. If this is not set,
it defaults to the <code>dockerbuild.yaml</code> in the working directory.</p>
<p>You can set:</p>
<ul>
<li><code>build_args: Dict[str, str]</code> </li>
<li><code>labels: Dict[str, str]</code></li>
<li><code>network: Optional[str]</code></li>
<li><code>platforms: Optional[List[str]]</code></li>
<li><code>secrets: Union[str, List[str]]</code></li>
<li><code>ssh: Optional[str]</code></li>
<li><code>target: Optional[str]</code></li>
</ul>
<p>These parameters refer to <a href="https://github.com/docker/buildx#buildx-bake-options-target">standard docker build parameters</a>.</p>
<p>One example use case can be when you want to git clone your internal repository during
the docker build.</p>
<p>In the <code>dockerbuild.yaml</code>:</p>
<pre><code>ssh: github=~/.ssh/id_rsa
</code></pre>
<p>In the <code>Dockerfile</code>:</p>
<pre><code>RUN mkdir -m 700 /root/.ssh; \
  touch -m 600 /root/.ssh/known_hosts; \
  ssh-keyscan git.int.avast.com &gt; /root/.ssh/known_hosts

RUN --mount=type=ssh,id=github git clone git@git.your.company.com:your_profile/your_repo.git
</code></pre>
<h3 id="parameters-for-docker-section">Parameters for docker section<a class="headerlink" href="#parameters-for-docker-section" title="Permanent link">#</a></h3>
<p>docker section takes following parameters:
- <code>images</code> - list of docker images, see below
- <code>repository</code>- GCP Artifact Registry repository for pushing images
- <code>registry</code>- (optional) GCP Artifact Registry, when not set it defaults to <code>{gcp_profile.region}-docker.pkg.dev</code>
- <code>cloud_build</code> - <code>false</code> (default) to build locally, <code>true</code> to use GCP Cloud Build  </p>
<h4 id="provided-image-parameters">Provided image parameters:<a class="headerlink" href="#provided-image-parameters" title="Permanent link">#</a></h4>
<ul>
<li><code>build_type: provided_image</code></li>
<li><code>name</code> - this will later be used in <code>docker_image_ref</code> in other resources</li>
<li><code>image_url</code> - link to the image</li>
</ul>
<h4 id="local-build-image-parameters">Local build image parameters:<a class="headerlink" href="#local-build-image-parameters" title="Permanent link">#</a></h4>
<ul>
<li><code>build_type: local_build_image</code></li>
<li><code>name</code> - this will later be used in <code>docker_image_ref</code> in other resources</li>
<li><code>build_args</code> - (optional) docker build args</li>
<li><code>context_dir</code> - Path to the docker build context directory</li>
<li><code>dockerfile</code> - Path to the Dockerfile</li>
</ul>
<h4 id="notebook-ready-image">Notebook ready image:<a class="headerlink" href="#notebook-ready-image" title="Permanent link">#</a></h4>
<ul>
<li><code>build_type: notebook_ready_image</code></li>
<li><code>name</code> - this will later be used in <code>docker_image_ref</code> in other resources</li>
<li><code>build_args</code> - (optional) docker build args</li>
<li><code>base_image</code> - (optional) base notebook docker image, you can check available images <a href="https://cloud.google.com/deep-learning-vm/docs/images">here</a>
  when not set, it defaults to standard base CPU notebook.</li>
<li><code>requirements_txt</code> - Path to the <code>requirements.txt</code> file</li>
</ul>
<h3 id="roles-and-permissions">Roles and permissions<a class="headerlink" href="#roles-and-permissions" title="Permanent link">#</a></h3>
<p>Permission and suggested roles (applying the principle of least privilege) required for docker images manipulation:</p>
<table>
<thead>
<tr>
<th>WANNA action</th>
<th>Permissions</th>
<th>Suggested Roles</th>
</tr>
</thead>
<tbody>
<tr>
<td>build in Cloud Build</td>
<td><code>cloudbuild.builds.create</code> and <a href="https://cloud.google.com/build/docs/iam-roles-permissions">more</a></td>
<td><code>roles/cloudbuild.builds.builder</code></td>
</tr>
<tr>
<td>push</td>
<td><code>artifactregistry.repositories.uploadArtifacts</code>, <code>artifactregistry.tags.create</code>, <code>artifactregistry.tags.update</code></td>
<td><code>roles/artifactregistry.writer</code></td>
</tr>
</tbody>
</table>
<p>For building the docker images locally, you will need permission to push to GCP as described above and running local Docker daemon.
You also have to authenticate docker with GCP, detailed documentation is <a href="https://cloud.google.com/artifact-registry/docs/docker/authentication">here</a>.
But generally, you should be fine with running:</p>
<pre><code class="language-bash">gcloud auth login

gcloud auth configure-docker europe-west1-docker.pkg.dev # Add more comma-separated repository hostnames if you wish
</code></pre>
<p><a href="https://cloud.google.com/build/docs/iam-roles-permissions">Full list of available roles and permission.</a></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../profile/" class="md-footer__link md-footer__link--prev" aria-label="Previous: WANNA Profile" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              WANNA Profile
            </div>
          </div>
        </a>
      
      
        
        <a href="../tensorboard/" class="md-footer__link md-footer__link--next" aria-label="Next: WANNA Tensorboard" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              WANNA Tensorboard
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.5e67fbfe.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.e87a5f81.min.js"></script>
      
    
  </body>
</html>